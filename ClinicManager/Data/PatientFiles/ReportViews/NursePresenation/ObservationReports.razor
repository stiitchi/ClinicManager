@page "/observation-reports/{PatientId:int}"
@using ClinicManager.Shared.DTO_s.Records
@using ClinicManager.Shared.DTO_s.Records.Observations
@using ClinicManager.Shared.Wrappers
@using ClinicManager.Web.Infrastructure.Services.PatientRecords
@inject IPatientRecordService patientRecordService 

<MudGrid>
    <MudItem xs="12" md="12" sm="12">
        <MudText Align="Align.Center" Typo="Typo.h6">
            Observation Reports
        </MudText>
    </MudItem>
    <MudItem xs="12" md="12" sm="12">
      <MudButton Variant="Variant.Outlined" Color="Color.Info"
                               Style="border-radius: 15px 15px;"
                               @onclick="@(() => _navigationManager.NavigateTo($"/nurse-presentation/{PatientId}"))">Back</MudButton>
    </MudItem>
</MudGrid>
@if
(
    _bloodReports.Count() > 0 ||
    _bloodGlucoseReports.Count() > 0 ||
    _neurologicalReports.Count() > 0 ||
    _neurovascularReports.Count() > 0 ||
    _urineTestReports.Count() > 0 ||
    _vitalSignReports.Count() > 0 
)
{
<MudGrid>
    @if (_bloodReports.Any() || _bloodGlucoseReports.Any() || _neurologicalReports.Any() || _neurovascularReports.Any() || _urineTestReports.Any() || _vitalSignReports.Any())
    {
        <MudItem xs="12" md="12" sm="12">        
            <MudGrid>
                @foreach (var report in _bloodReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Error">@report.BloodId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Blood Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                      <MudItem md="6" sm="6">
                                            <MudText Typo="Typo.body2">Frequency</MudText>
                                      </MudItem>
                                      <MudItem md="6" sm="6">
                                            <MudChip Color="Color.Warning">@report.BloodFrequency</MudChip>
                                      </MudItem>
                                      <MudItem md="6" sm="6">
                                            <MudText Typo="Typo.body2">Time Added</MudText>
                                      </MudItem>
                                      <MudItem md="6" sm="6">
                                            <MudChip Color="Color.Warning">@report.BloodTime.ToString("HH:mm")</MudChip>
                                      </MudItem>
                                 </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }

                @foreach (var report in _bloodGlucoseReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Info">@report.BloodGlucoseId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Blood Glucose Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Frequency</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.BloodGlucoseFrequency</MudChip>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Time Added</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.BloodGlucoseTime.ToString("HH:mm")</MudChip>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }

                @foreach (var report in _neurologicalReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Secondary">@report.NeuroLogicalId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Neurological Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Frequency</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.NeuroLogicalFrequency</MudChip>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Time Added</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.NeuroLogicalTime.ToString("HH:mm")</MudChip>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }

                @foreach (var report in _neurovascularReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Success">@report.NeuroVascularId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Neurovascular Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Frequency</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.NeuroVascularFrequency</MudChip>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Time Added</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.NeuroVascularTime.ToString("HH:mm")</MudChip>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }

                @foreach (var report in _urineTestReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Warning">@report.UrineTestId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Urine Test Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Frequency</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.UrineTestFrequency</MudChip>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Time Added</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.UrineTestTime.ToString("HH:mm")</MudChip>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }

                @foreach (var report in _vitalSignReports)
                {
                    <MudItem md="3" sm="3">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Info">@report.VitalSignsId</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudText Align="Align.Center" Typo="Typo.inherit">
                                        Vital Sign Report
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Frequency</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.VitalSignsFrequency</MudChip>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudText Typo="Typo.body2">Time Added</MudText>
                                    </MudItem>
                                    <MudItem md="6" sm="6">
                                        <MudChip Color="Color.Warning">@report.VitalSignsTime.ToString("HH:mm")</MudChip>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>
    }
</MudGrid>
}
else
{
    <MudItem xs="12" md="12" sm="12">
        <MudText Align="Align.Center" Typo="Typo.body1">No Observation Reports Found</MudText> 
    </MudItem>
}

@code {
    [Parameter] public int PatientId { get; set; } 
    private List<BloodDTO> _bloodReports = new();
    private List<BloodGlucoseDTO> _bloodGlucoseReports = new();
    private List<NeuroLogicalDTO> _neurologicalReports = new();
    private List<NeuroVascularDTO> _neurovascularReports = new();
    private List<UrineTestDTO> _urineTestReports = new();
    private List<VitalSignDTO> _vitalSignReports = new();

    protected async override Task OnInitializedAsync()
    {     
        await GetAllBloodReports(PatientId);
        await GetAllBloodGlucoseReports(PatientId);
        await GetAllGetNeurologicalReports(PatientId);
        await GetAllGetNeurologicalReports(PatientId);
        await GetAllGetNeurovascularReports(PatientId);
        await GetAllGetUrineTestReports(PatientId);
        await GetAllGetVitalSignReports(PatientId);
    }

    public async Task GetAllBloodReports(int patientId)
    {
        var reports = await patientRecordService.GetAllBloodFrequencyRecordsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _bloodReports = reports.Data;
        }
    }  
    public async Task GetAllBloodGlucoseReports(int patientId)
    {
        var reports = await patientRecordService.GetAllBloodGlucoseRecordsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _bloodGlucoseReports = reports.Data;
        }
    }
    public async Task GetAllGetNeurologicalReports(int patientId)
    {
        var reports = await patientRecordService.GetAllNeuroLogicalRecordsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _neurologicalReports = reports.Data;
        }
    }
     public async Task GetAllGetNeurovascularReports(int patientId)
    {
        var reports = await patientRecordService.GetAllNeuroVascularPatientId(patientId);
        if (reports.Succeeded)
        {
            _neurovascularReports = reports.Data;
        }
    }
    public async Task GetAllGetUrineTestReports(int patientId)
    {
        var reports = await patientRecordService.GetAllUrineTestsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _urineTestReports = reports.Data;
        }
    }
    public async Task GetAllGetVitalSignReports(int patientId)
    {
        var reports = await patientRecordService.GetAllVitalSignRecordsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _vitalSignReports = reports.Data;
        }
    }
}