@page "/skin-integrity/{PatientId:int}"
@using ClinicManager.Shared.DTO_s.Records.Observations
@using ClinicManager.Shared.DTO_s.Records.SkinReport
@using ClinicManager.Shared.Wrappers
@using ClinicManager.Web.Infrastructure.Services.PatientRecords
@inject IPatientRecordService patientRecordService 

<MudGrid>
    <MudItem xs="12" md="12" sm="12">
        <MudText Align="Align.Center" Typo="Typo.h6">
            Skin Integrity View
        </MudText>
    </MudItem>
    <MudItem xs="12" md="12" sm="12">
      <MudButton Variant="Variant.Outlined" Color="Color.Info"
                               Style="border-radius:10px 10px 10px 10px"
                               @onclick="@(() => _navigationManager.NavigateTo($"/patient-view/{PatientId}"))">Back</MudButton>
    </MudItem>

    @foreach(var report in _reports)
    {
    <MudItem md="6" sm="12">
        <MudCard>
            <MudCardHeader>
                <CardHeaderAvatar>
                    <MudAvatar Color="Color.Info">  @report.SkinIntegrityId</MudAvatar>
                </CardHeaderAvatar>
            </MudCardHeader>
            <MudCardContent>
                <MudTabs>
                    <MudTabPanel Text="Sacrum">
                        <center>
                            <MudText Class="mt-5" Typo="Typo.body1">
                                @report.SacrumDescription
                            </MudText>
                        </center>
                    </MudTabPanel>
                    <MudTabPanel Text="Hips">
                        <center>
                            <MudText Class="mt-5" Typo="Typo.body1">
                                @report.HipsDescription
                            </MudText>
                        </center>
                    </MudTabPanel>
                    <MudTabPanel Text="Heals">
                        <center>
                            <MudText Class="mt-5" Typo="Typo.body1">
                                @report.HealsDescription
                            </MudText>
                        </center>
                    </MudTabPanel>
                      <MudTabPanel Text="Other">
                        <center>
                            <MudText Class="mt-5" Typo="Typo.body1">
                                @report.OtherDescription
                            </MudText>
                        </center>
                    </MudTabPanel>
                    <MudTabPanel Text="Comments">
                        <center>
                            <MudText Class="mt-5" Typo="Typo.body1">
                                @report.Comments
                            </MudText>
                        </center>
                    </MudTabPanel>
                </MudTabs>
            </MudCardContent>
        </MudCard>
    </MudItem>
    }
</MudGrid>

@code {
    private List<SkinReportDTO> _reports = new();
    [Parameter] public int PatientId { get; set; } 

    protected async override Task OnInitializedAsync()
    {
        await GetAllReports(PatientId);
    }

    public async Task GetAllReports(int patientId)
    {
        var reports = await patientRecordService.GetAllSkinReportsByPatientId(patientId);
        if (reports.Succeeded)
        {
            _reports = reports.Data;
        }
    }  
}